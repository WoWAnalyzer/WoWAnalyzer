import SPELLS from 'common/SPELLS';
import { MappedEvent, EventType } from 'parser/core/Events';
import EventsNormalizer from 'parser/core/EventsNormalizer';
import getResourceSpent from 'parser/core/getResourceSpent';
import RESOURCE_TYPES from 'game/RESOURCE_TYPES';

//--TODO: might not want to straight up remove the events but maybe change them to damage events

// This normalizer remove the subsequent pistol shots cast events generated by "fan the hammer" talent
// that are not diferenciated from player casted pistol shots in log events
class FanTheHammerNormalizer extends EventsNormalizer {
  normalize(events: MappedEvent[]) {
    const fixedEvents: MappedEvent[] = [];
    const pistolShotCastId = SPELLS.PISTOL_SHOT.id;

    events.forEach((event: MappedEvent, idx: number) => {
      //Wwe only want to check pistol shots casts
      fixedEvents.push(event);

      if (event.type !== EventType.Cast) {
        return;
      }

      const spellId = event.ability.guid;
      const energyCost = getResourceSpent(event, RESOURCE_TYPES.ENERGY);
      if (spellId !== pistolShotCastId || energyCost) {
        return;
      }

      fixedEvents.pop();
    });
    return fixedEvents;
  }
}
export default FanTheHammerNormalizer;
